import streamlit as st
import time

st.set_page_config(page_title="íŠ¼íŠ¼ì´ ê±´ê°• ìƒë‹´ ì±—ë´‡", page_icon="ğŸ©º")

# ì‚¬ìš©ì ì •ë³´ ì„¸ì…˜ ê´€ë¦¬
if 'user_info' not in st.session_state:
    st.session_state.user_info = None

# ì±—ë´‡ ìºë¦­í„° ë° ìŠ¤íƒ€ì¼
chatbot_name = "íŠ¼íŠ¼ì´"
chatbot_icon = "ğŸ©º"

# CSS ìŠ¤íƒ€ì¼
st.markdown("""
    <style>
    .chat-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    .chat-message {
        padding: 0.75rem 1rem;
        border-radius: 18px;
        max-width: 80%;
        width: fit-content;
        font-size: 0.95rem;
        line-height: 1.5;
        box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }
    .user {
        background-color: #DCF8C6;
        align-self: flex-end;
        margin-left: auto;
    }
    .bot {
        background-color: #F1F0F0;
        align-self: flex-start;
        margin-right: auto;
    }
    .icon {
        font-weight: bold;
        margin-right: 6px;
    }
    </style>
""", unsafe_allow_html=True)

# ì‚¬ìš©ì ì •ë³´ ì…ë ¥
if st.session_state.user_info is None:
    with st.form("user_info_form"):
        st.title("ğŸ‘¤ ì‚¬ìš©ì ì •ë³´ ë“±ë¡")
        name = st.text_input("ì´ë¦„")
        age = st.number_input("ë‚˜ì´", min_value=1, max_value=120)
        region = st.selectbox("ì†Œì† ì§€ì—­", ["ì„œìš¸", "ê²½ê¸°", "ë¶€ì‚°", "ëŒ€êµ¬", "ì¸ì²œ", "ê¸°íƒ€"])
        height = st.number_input("í‚¤ (cm)", min_value=100, max_value=220)
        weight = st.number_input("ëª¸ë¬´ê²Œ (kg)", min_value=30, max_value=200)
        submitted = st.form_submit_button("ì •ë³´ ë“±ë¡")

        if submitted and name and height and weight:
            bmi = round(weight / ((height / 100) ** 2), 2)
            st.session_state.user_info = {
                "name": name, "age": age, "region": region,
                "height": height, "weight": weight, "bmi": bmi
            }
            st.success("âœ… ì‚¬ìš©ì ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒë‹´ì„ ì‹œì‘í•©ë‹ˆë‹¤.")
            st.experimental_rerun()

# ì‚¬ìš©ì ì •ë³´ ë“±ë¡ í›„ ì±—ë´‡ ì‹¤í–‰
if st.session_state.user_info:
    user = st.session_state.user_info
    st.title(f"ğŸ©º {chatbot_name}ì™€ì˜ ê±´ê°• ìƒë‹´")
    st.caption(f"ğŸ“ ì§€ì—­: {user['region']} | BMI: {user['bmi']}")

    # ë¶„ì•¼ë³„ ì§ˆë¬¸ ë°ì´í„°
    question_categories = {
        "ê±´ê°•ê²€ì§„": {
            "ê±´ê°•ê²€ì§„ì€ ëª‡ ë…„ë§ˆë‹¤ ë°›ì•„ì•¼ í•˜ë‚˜ìš”?": "ì„±ì¸ì€ ì¼ë°˜ì ìœ¼ë¡œ 2ë…„ì— í•œ ë²ˆ êµ­ê°€ ê±´ê°•ê²€ì§„ ëŒ€ìƒì…ë‹ˆë‹¤.",
            "ê²€ì§„ í•­ëª©ì€ ì–´ë–¤ ê²Œ í¬í•¨ë˜ë‚˜ìš”?": "ê¸°ë³¸ê²€ì§„, í˜ˆì••, í˜ˆì•¡, ì‹œë ¥, ì²­ë ¥, êµ¬ê°•ê²€ì§„ ë“±ì´ í¬í•¨ë©ë‹ˆë‹¤.",
            "ì²­ì†Œë…„ë„ ê±´ê°•ê²€ì§„ ëŒ€ìƒì¸ê°€ìš”?": "ì²­ì†Œë…„ì€ í•™êµ ê±´ê°•ê²€ì§„ì´ ìš°ì„  ì‹œí–‰ë˜ë©° ì¶”ê°€ ê²€ì§„ì€ ë³„ë„ì…ë‹ˆë‹¤.",
            "ê²€ì§„ë°›ì„ ë³‘ì›ì€ ì–´ë””ì„œ í™•ì¸í•˜ë‚˜ìš”?": "êµ­ë¯¼ê±´ê°•ë³´í—˜ê³µë‹¨ í™ˆí˜ì´ì§€ ë˜ëŠ” ì•±ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ê²€ì§„ ì „ ì£¼ì˜ì‚¬í•­ì€ ë¬´ì—‡ì¸ê°€ìš”?": "ê¸ˆì‹ ì—¬ë¶€, ì•½ ë³µìš© ì—¬ë¶€ ë“±ì€ ë³‘ì› ì•ˆë‚´ë¥¼ ê¼­ ë”°ë¥´ì„¸ìš”.",
            "ì§ì¥ì¸ ê±´ê°•ê²€ì§„ë„ êµ­ê°€ ê²€ì§„ì¸ê°€ìš”?": "ë„¤, ì‚¬ì—…ì¥ ì œê³µ ê²€ì§„ë„ êµ­ê°€ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.",
            "ë¬´ë£Œë¡œ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?": "êµ­ê°€ ê±´ê°•ê²€ì§„ì€ ì—°ë ¹ë³„, ì§ì¥ê°€ì…ì ë“±ì— ë”°ë¼ ë¬´ë£Œ ì œê³µë©ë‹ˆë‹¤.",
            "ê²€ì§„ê²°ê³¼ëŠ” ì–´ë””ì„œ í™•ì¸í•˜ë‚˜ìš”?": "ë³‘ì› ë˜ëŠ” ê±´ê°•ê²€ì§„ ì‚¬ì´íŠ¸ì—ì„œ ë¡œê·¸ì¸ í›„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤."
        },
        "ì •ì‹ ê±´ê°•": {
            "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì¤„ì´ëŠ” ë°©ë²•ì€?": "ê·œì¹™ì ì¸ ìˆ˜ë©´, ìš´ë™, ëª…ìƒ ë“±ì´ ë„ì›€ì´ ë©ë‹ˆë‹¤.",
            "ë¶ˆì•ˆê°ì´ ì‹¬í•  ë•Œ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?": "í˜¸í¡ ì¡°ì ˆ, ëŒ€í™”, ìƒë‹´ì„¼í„° ì´ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
            "ìš°ìš¸í•œ ê°ì •ì´ ìì£¼ ë“œëŠ”ë° ì–´ë–»ê²Œ í• ê¹Œìš”?": "ì „ë¬¸ê°€ì™€ì˜ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
            "ê³µë¶€ë‚˜ ì¼ì´ ì†ì— ì¡íˆì§€ ì•Šì„ ë•?": "ì ì‹œ ì‰¬ëŠ” ì‹œê°„ê³¼ í™˜ê²½ ë³€í™”ê°€ ë„ì›€ì´ ë©ë‹ˆë‹¤.",
            "ë§ˆìŒì´ ì§€ì¹  ë•Œ ì‰´ ìˆ˜ ìˆëŠ” ë°©ë²•ì€?": "ì‚°ì±…, ìŒì•… ë“£ê¸°, ë”°ëœ»í•œ ì°¨ í•œ ì”ë„ ì¢‹ì•„ìš”.",
            "ëª…ìƒì´ë‚˜ í˜¸í¡ í›ˆë ¨ì´ ì •ë§ íš¨ê³¼ê°€ ìˆë‚˜ìš”?": "ê³¼í•™ì ìœ¼ë¡œë„ íš¨ê³¼ê°€ ì…ì¦ëœ ë°©ë²•ì…ë‹ˆë‹¤.",
            "ìƒë‹´ì„¼í„°ëŠ” ëˆ„êµ¬ë‚˜ ì´ìš©í•  ìˆ˜ ìˆë‚˜ìš”?": "ëŒ€ë¶€ë¶„ì˜ ì§€ì—­ì„¼í„°ëŠ” ë¬´ë£Œë¡œ ìš´ì˜ë©ë‹ˆë‹¤.",
            "ê°€ë”ì”© ì•„ë¬´ ì´ìœ  ì—†ì´ ë¶ˆì•ˆí•´ì§€ëŠ”ë° ê´œì°®ì„ê¹Œìš”?": "ë°˜ë³µë˜ë©´ ì „ë¬¸ê°€ ìƒë‹´ì´ í•„ìš”í•©ë‹ˆë‹¤."
        },
        "BMI": {
            "ë‚´ BMIê°€ ì •ìƒì¸ê°€ìš”?": f"BMI {user['bmi']}ì€(ëŠ”) {'ì •ìƒ ë²”ìœ„ì…ë‹ˆë‹¤.' if 18.5 <= user['bmi'] <= 24.9 else 'ì •ìƒ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤.'}",
            "BMI ìˆ˜ì¹˜ê°€ ë†’ìœ¼ë©´ ê±´ê°•ì— ì•ˆ ì¢‹ì€ê°€ìš”?": "ê³ í˜ˆì••, ë‹¹ë‡¨ ë“± ë§Œì„±ì§ˆí™˜ê³¼ ì—°ê´€ì´ ìˆìŠµë‹ˆë‹¤.",
            "ì²´ì¤‘ ê°ëŸ‰ì„ í•˜ë ¤ë©´ ë¬´ì—‡ë¶€í„° í•´ì•¼ í•˜ë‚˜ìš”?": "ì‹ìŠµê´€ ê°œì„ ê³¼ ê¾¸ì¤€í•œ ìš´ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.",
            "BMIë§Œìœ¼ë¡œ ë¹„ë§Œ ì—¬ë¶€ë¥¼ íŒë‹¨í•  ìˆ˜ ìˆë‚˜ìš”?": "ì²´ì§€ë°©ë¥ , í—ˆë¦¬ë‘˜ë ˆ ë“± ë‹¤ë¥¸ ì§€í‘œë„ í•¨ê»˜ ë´ì•¼ í•©ë‹ˆë‹¤.",
            "ì²­ì†Œë…„ BMI ê¸°ì¤€ì€ ì–´ë–»ê²Œ ë‹¤ë¥¸ê°€ìš”?": "ì„±ì¥ ê³¡ì„ ì„ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€í•©ë‹ˆë‹¤.",
            "ì‚´ì„ ë¹¼ë©´ BMIë„ ë°”ë¡œ ì¤„ì–´ë“œë‚˜ìš”?": "ì²´ì¤‘ì´ ì¤„ë©´ BMIë„ ê°ì†Œí•©ë‹ˆë‹¤.",
            "ì •ìƒ ì²´ì¤‘ì´ì–´ë„ ìš´ë™ì€ í•„ìš”í•œê°€ìš”?": "ë¬¼ë¡ ì…ë‹ˆë‹¤. ê±´ê°• ìœ ì§€ë¥¼ ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.",
            "BMIê°€ ë‚®ì•„ë„ ë¬¸ì œì¸ê°€ìš”?": "ë„ˆë¬´ ë‚®ì€ ê²½ìš°ë„ ë¹ˆí˜ˆ, ë©´ì—­ë ¥ ì €í•˜ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤."
        }
    }

    category = st.selectbox("ğŸ“š ìƒë‹´ ë¶„ì•¼ë¥¼ ì„ íƒí•˜ì„¸ìš”:", list(question_categories.keys()))
    selected_question = st.radio("ğŸ’¬ ì•„ë˜ ì§ˆë¬¸ ì¤‘ ê¶ê¸ˆí•œ í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”:", list(question_categories[category].keys()))

    if st.button("ğŸ—¨ï¸ íŠ¼íŠ¼ì´ì—ê²Œ ë¬¼ì–´ë³´ê¸°"):
        st.markdown('<div class="chat-container">', unsafe_allow_html=True)
        st.markdown(
            f'<div class="chat-message user"><span class="icon">ğŸ™‹â€â™€ï¸</span>{selected_question}</div>',
            unsafe_allow_html=True,
        )
        time.sleep(0.7)
        st.markdown(
            f'<div class="chat-message bot"><span class="icon">{chatbot_icon}</span>{question_categories[category][selected_question]}</div>',
            unsafe_allow_html=True,
        )
        time.sleep(0.7)
        again = st.radio("ğŸ§ ë‹¤ë¥¸ ì§ˆë¬¸ì´ ìˆìœ¼ì‹ ê°€ìš”?", ["ë„¤! ë‹¤ë¥¸ ì§ˆë¬¸ ì„ íƒí•˜ê¸°", "ì•„ë‹ˆìš”, ì¢…ë£Œí• ê²Œìš”"])
        st.markdown('</div>', unsafe_allow_html=True)
        if again == "ë„¤! ë‹¤ë¥¸ ì§ˆë¬¸ ì„ íƒí•˜ê¸°":
            st.experimental_rerun()
        else:
            st.success("ğŸ’¡ ìƒë‹´ì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤. ì–¸ì œë“  ë‹¤ì‹œ ì°¾ì•„ì£¼ì„¸ìš”.")

# ì‚¬ì´ë“œë°” ì¶”ì²œ ê¸°ëŠ¥
st.sidebar.markdown("""
### ğŸ“Œ íŠ¼íŠ¼ì´ ì¶”ì²œ ê¸°ëŠ¥
- ğŸ’‰ êµ­ê°€ ê±´ê°•ê²€ì§„ ì‹œê¸° ì•Œë¦¼
- ğŸ—“ï¸ ì—°ë ¹ë³„ í•„ìˆ˜ ì˜ˆë°©ì ‘ì¢… í™•ì¸
- ğŸ“ ì§€ì—­ ë³µì§€ê´€ ìš´ë™ í”„ë¡œê·¸ë¨ ì•ˆë‚´
- ğŸ“ ê±´ê°•ë³´í—˜ê³µë‹¨ ë¯¼ì› ê°„í¸ ì—°ê²°
""")