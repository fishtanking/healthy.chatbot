import streamlit as st
import time

# ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="íŠ¼íŠ¼ì´ ê±´ê°• ìƒë‹´ ì±—ë´‡", page_icon="ğŸ©º")

# ì±—ë´‡ ì´ë¦„ ë° ìŠ¤íƒ€ì¼
chatbot_icon = "ğŸ©º"
chatbot_name = "íŠ¼íŠ¼ì´"

# CSS ìŠ¤íƒ€ì¼ ì‚½ì…
st.markdown("""
<style>
.chat-container {
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
    margin-bottom: 1rem;
}
.chat-message {
    padding: 0.9rem 1.2rem;
    border-radius: 18px;
    max-width: 80%;
    width: fit-content;
    font-size: 0.96rem;
    line-height: 1.5;
    box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
}
.user {
    background-color: #DCF8C6;
    align-self: flex-end;
    margin-left: auto;
}
.bot {
    background-color: #F1F0F0;
    align-self: flex-start;
    margin-right: auto;
}
.icon {
    font-weight: bold;
    margin-right: 6px;
}
</style>
""", unsafe_allow_html=True)

# ì‚¬ìš©ì ì •ë³´ ì„¸ì…˜ ì´ˆê¸°í™”
if 'user_info' not in st.session_state:
    st.session_state.user_info = None

# ì‚¬ìš©ì ì •ë³´ ì…ë ¥
if st.session_state.user_info is None:
    st.title("ğŸ‘¤ ì‚¬ìš©ì ì •ë³´ ì…ë ¥")
    with st.form("info_form"):
        name = st.text_input("ì´ë¦„")
        age = st.number_input("ë‚˜ì´", min_value=1, max_value=100)
        region = st.selectbox("ì†Œì† ì§€ì—­", ["ì„œìš¸", "ê²½ê¸°", "ë¶€ì‚°", "ëŒ€êµ¬", "ì¸ì²œ", "ê¸°íƒ€"])
        height = st.number_input("í‚¤ (cm)", min_value=100, max_value=220)
        weight = st.number_input("ëª¸ë¬´ê²Œ (kg)", min_value=30, max_value=200)
        submitted = st.form_submit_button("ì •ë³´ ë“±ë¡")

    if submitted and name and height and weight:
        bmi = round(weight / ((height / 100) ** 2), 2)
        st.session_state.user_info = {
            "name": name, "age": age, "region": region,
            "height": height, "weight": weight, "bmi": bmi
        }
        st.success(f"âœ… ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. BMIëŠ” {bmi}ì…ë‹ˆë‹¤.")
        st.experimental_rerun()

# ì‚¬ìš©ì ì •ë³´ ë“±ë¡ í›„ ì±—ë´‡ ì‹¤í–‰
if st.session_state.user_info:
    user = st.session_state.user_info
    st.title(f"ğŸ©º {chatbot_name} ê±´ê°• ìƒë‹´ ì±—ë´‡")
    st.caption(f"ğŸ“ ì§€ì—­: {user['region']} / BMI: {user['bmi']}")

    # ë¶„ì•¼ë³„ ì§ˆë¬¸ ì •ì˜
    question_db = {
        "ê±´ê°•ê²€ì§„": {
            "ê±´ê°•ê²€ì§„ì€ ëª‡ ë…„ë§ˆë‹¤ ë°›ì•„ì•¼ í•˜ë‚˜ìš”?": "ì„±ì¸ì€ 2ë…„ì— í•œ ë²ˆì”© êµ­ê°€ ê±´ê°•ê²€ì§„ ëŒ€ìƒì…ë‹ˆë‹¤.",
            "ê²€ì§„ í•­ëª©ì€ ì–´ë–¤ ê²Œ í¬í•¨ë˜ë‚˜ìš”?": "í˜ˆì••, í˜ˆì•¡, ì‹œë ¥, ì²­ë ¥, ê°„ ê¸°ëŠ¥ ë“± ê¸°ë³¸ ê²€ì‚¬ê°€ í¬í•¨ë©ë‹ˆë‹¤.",
            "ì²­ì†Œë…„ë„ ê±´ê°•ê²€ì§„ ëŒ€ìƒì¸ê°€ìš”?": "ì²­ì†Œë…„ì€ í•™êµ ê±´ê°•ê²€ì§„ ì™¸ í•„ìš”ì‹œ ì¶”ê°€ ê²€ì§„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
            "ê²€ì§„ë°›ì„ ë³‘ì›ì€ ì–´ë””ì„œ í™•ì¸í•˜ë‚˜ìš”?": "ê±´ê°•ë³´í—˜ê³µë‹¨ í™ˆí˜ì´ì§€ë‚˜ ì•±ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
            "ê²€ì§„ ì „ ì£¼ì˜ì‚¬í•­ì€ ë¬´ì—‡ì¸ê°€ìš”?": "ê²€ì§„ ì „ 8ì‹œê°„ ê¸ˆì‹ ë“± ì£¼ì˜ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤.",
            "ì§ì¥ì¸ ê±´ê°•ê²€ì§„ë„ êµ­ê°€ ê²€ì§„ì¸ê°€ìš”?": "ë„¤, ì§ì¥ê°€ì…ìë„ ê±´ê°•ë³´í—˜ê³µë‹¨ ê²€ì§„ ëŒ€ìƒì…ë‹ˆë‹¤.",
            "ë¬´ë£Œë¡œ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?": "ì¼ì • ì—°ë ¹ ë° ì§ì¥ê°€ì…ì ë“±ì€ ë¬´ë£Œë¡œ ê²€ì§„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
            "ê²€ì§„ê²°ê³¼ëŠ” ì–´ë””ì„œ í™•ì¸í•˜ë‚˜ìš”?": "ê²€ì§„ ë³‘ì› ë˜ëŠ” ê±´ê°•iN ì‚¬ì´íŠ¸ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤."
        },
        "ì •ì‹ ê±´ê°•": {
            "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì¤„ì´ëŠ” ë°©ë²•ì€?": "ì¶©ë¶„í•œ ìˆ˜ë©´, ìš´ë™, ëª…ìƒ ë“±ì´ ìŠ¤íŠ¸ë ˆìŠ¤ ì™„í™”ì— íš¨ê³¼ì ì…ë‹ˆë‹¤.",
            "ë¶ˆì•ˆê°ì´ ì‹¬í•  ë•Œ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?": "í˜¸í¡ ì¡°ì ˆ, ì¹œêµ¬ì™€ ëŒ€í™”, ìƒë‹´ì„¼í„° ì´ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
            "ìš°ìš¸í•œ ê°ì •ì´ ìì£¼ ë“œëŠ”ë° ì–´ë–»ê²Œ í• ê¹Œìš”?": "ë°˜ë³µëœë‹¤ë©´ ì •ì‹ ê±´ê°• ì „ë¬¸ê°€ì™€ ìƒë‹´í•´ë³´ì„¸ìš”.",
            "ê³µë¶€ë‚˜ ì¼ì´ ì†ì— ì¡íˆì§€ ì•Šì„ ë•?": "ì§§ì€ ì‚°ì±…ì´ë‚˜ ì ê¹ì˜ ì „í™˜ í™œë™ì´ ë„ì›€ì´ ë©ë‹ˆë‹¤.",
            "ë§ˆìŒì´ ì§€ì¹  ë•Œ ì‰´ ìˆ˜ ìˆëŠ” ë°©ë²•ì€?": "ìŒì•… ë“£ê¸°, ì‚°ì±…, ë”°ëœ»í•œ ì°¨ í•œ ì” ì¶”ì²œí•©ë‹ˆë‹¤.",
            "ëª…ìƒì´ë‚˜ í˜¸í¡ í›ˆë ¨ì´ ì •ë§ íš¨ê³¼ê°€ ìˆë‚˜ìš”?": "ë„¤, ë§ì€ ì—°êµ¬ì—ì„œ ê³¼í•™ì ìœ¼ë¡œ ì…ì¦ëìŠµë‹ˆë‹¤.",
            "ìƒë‹´ì„¼í„°ëŠ” ëˆ„êµ¬ë‚˜ ì´ìš©í•  ìˆ˜ ìˆë‚˜ìš”?": "ì§€ì—­ ì •ì‹ ê±´ê°•ë³µì§€ì„¼í„°ëŠ” ëŒ€ë¶€ë¶„ ë¬´ë£Œë¡œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.",
            "ê°€ë”ì”© ì•„ë¬´ ì´ìœ  ì—†ì´ ë¶ˆì•ˆí•´ì§€ëŠ”ë° ê´œì°®ì„ê¹Œìš”?": "ìì£¼ ë°˜ë³µëœë‹¤ë©´ ì „ë¬¸ê°€ ìƒë‹´ì´ í•„ìš”í•©ë‹ˆë‹¤."
        },
        "BMI": {
            "ë‚´ BMIê°€ ì •ìƒì¸ê°€ìš”?": f"BMI {user['bmi']}ëŠ” {'ì •ìƒ ë²”ìœ„ì…ë‹ˆë‹¤.' if 18.5 <= user['bmi'] <= 24.9 else 'ì •ìƒ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤.'}",
            "BMI ìˆ˜ì¹˜ê°€ ë†’ìœ¼ë©´ ê±´ê°•ì— ì•ˆ ì¢‹ì€ê°€ìš”?": "ë¹„ë§Œì€ ì‹¬í˜ˆê´€ ì§ˆí™˜, ë‹¹ë‡¨ ë“±ê³¼ ê´€ë ¨ ìˆìŠµë‹ˆë‹¤.",
            "ì²´ì¤‘ ê°ëŸ‰ì„ í•˜ë ¤ë©´ ë¬´ì—‡ë¶€í„° í•´ì•¼ í•˜ë‚˜ìš”?": "ì‹ìŠµê´€ ì¡°ì ˆê³¼ ìš´ë™ ë³‘í–‰ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
            "BMIë§Œìœ¼ë¡œ ë¹„ë§Œ ì—¬ë¶€ë¥¼ íŒë‹¨í•  ìˆ˜ ìˆë‚˜ìš”?": "ì•„ë‹ˆìš”. ì²´ì§€ë°©ë¥ , ë³µë¶€ë‘˜ë ˆ ë“±ë„ ì°¸ê³ í•´ì•¼ í•©ë‹ˆë‹¤.",
            "ì²­ì†Œë…„ BMI ê¸°ì¤€ì€ ì–´ë–»ê²Œ ë‹¤ë¥¸ê°€ìš”?": "ì„±ì¥ ê³¡ì„ ì„ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.",
            "ì‚´ì„ ë¹¼ë©´ BMIë„ ë°”ë¡œ ì¤„ì–´ë“œë‚˜ìš”?": "ì²´ì¤‘ì´ ì¤„ë©´ BMIë„ ì¤„ì–´ë“­ë‹ˆë‹¤.",
            "ì •ìƒ ì²´ì¤‘ì´ì–´ë„ ìš´ë™ì€ í•„ìš”í•œê°€ìš”?": "ê±´ê°• ìœ ì§€ë¥¼ ìœ„í•´ ìš´ë™ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.",
            "BMIê°€ ë‚®ì•„ë„ ë¬¸ì œì¸ê°€ìš”?": "ë„ˆë¬´ ë‚®ìœ¼ë©´ ë©´ì—­ë ¥ ì €í•˜, ë¹ˆí˜ˆ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤."
        }
    }

    # ë¶„ì•¼ ì„ íƒ
    category = st.selectbox("ğŸ’¡ ìƒë‹´ë°›ê³  ì‹¶ì€ ë¶„ì•¼ë¥¼ ì„ íƒí•˜ì„¸ìš”:", list(question_db.keys()))
    question = st.radio("ğŸ¤” ì–´ë–¤ ì§ˆë¬¸ì´ ê¶ê¸ˆí•œê°€ìš”?", list(question_db[category].keys()))

    if st.button("ğŸ—¨ï¸ ì§ˆë¬¸í•˜ê¸°"):
        st.markdown('<div class="chat-container">', unsafe_allow_html=True)
        st.markdown(
            f'<div class="chat-message user"><span class="icon">ğŸ™‹â€â™‚ï¸</span>{question}</div>',
            unsafe_allow_html=True,
        )
        time.sleep(0.6)
        st.markdown(
            f'<div class="chat-message bot"><span class="icon">{chatbot_icon}</span>{question_db[category][question]}</div>',
            unsafe_allow_html=True,
        )
        time.sleep(0.5)
        again = st.radio("ğŸ” ë‹¤ë¥¸ ì§ˆë¬¸ì´ ìˆìœ¼ì‹ ê°€ìš”?", ["ì˜ˆ, ë‹¤ì‹œ ì„ íƒí• ê²Œìš”", "ì•„ë‹ˆìš”, ì¢…ë£Œí• ê²Œìš”"])
        if again == "ì˜ˆ, ë‹¤ì‹œ ì„ íƒí• ê²Œìš”":
            st.experimental_rerun()
        else:
            st.success("ìƒë‹´ì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤. ì–¸ì œë“ ì§€ ë‹¤ì‹œ ì°¾ì•„ì£¼ì„¸ìš”!")
        st.markdown('</div>', unsafe_allow_html=True)

# ì‚¬ì´ë“œë°” ê¸°ëŠ¥ ì¶”ì²œ
st.sidebar.markdown("""
### ğŸ›ï¸ íŠ¼íŠ¼ì´ ì¶”ì²œ ì„œë¹„ìŠ¤
- êµ­ê°€ ê±´ê°•ê²€ì§„ ëŒ€ìƒ í™•ì¸
- ì—°ë ¹ë³„ ì˜ˆë°©ì ‘ì¢… í™•ì¸
- ì§€ì—­ ë³µì§€ê´€ ê±´ê°• í”„ë¡œê·¸ë¨ ì•ˆë‚´
- ê±´ê°•ë³´í—˜ê³µë‹¨ ë¯¼ì› ì—°ê²° ì•ˆë‚´
""")
